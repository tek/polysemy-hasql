name: polysemy-hasql
synopsis: Polysemy effects for Hasql
<<: !include shared/meta.yaml
defaults:
  local: shared/defaults.yaml

library:
  source-dirs: lib
  generated-exposed-modules:
    - Paths_polysemy_hasql

tests:
  polysemy-hasql-unit:
    <<: !include shared/test.yaml
    source-dirs: test
    dependencies:
      - polysemy-hasql
  polysemy-hasql-integration:
    <<: !include shared/test.yaml
    source-dirs: integration
    # dependencies:
    #   - polysemy-hasql

dependencies:
  - chronos
  - hasql
  - path
  - scientific
  - time
  - type-errors
  - type-errors-pretty
  - uuid
  - vector
  - name: polysemy-db
    mixin:
      - hiding (Polysemy.Db.Prelude)
      - (Polysemy.Db.Prelude as Prelude)

when:
  - condition: '!arch(arm) && !arch(aarch64)'
    ghc-options:
      - -fplugin=Polysemy.Plugin
      - -O2
      - -flate-specialise
      - -fspecialise-aggressively
    dependencies:
      - polysemy-plugin
